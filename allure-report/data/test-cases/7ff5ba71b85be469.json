{"uid":"7ff5ba71b85be469","name":"test_cubix_download_pdf_on_agent_page[webkit]","fullName":"tests.ui.qube.cubix.test_cubix_agent_route#test_cubix_download_pdf_on_agent_page","historyId":"ebca0dbb9f0aed0226291897e92c8a0b","time":{"start":1763492169149,"stop":1763492209590,"duration":40441},"description":"Тест скачивания PDF на агентской странице проекта Cubix.","descriptionHtml":"<p>Тест скачивания PDF на агентской странице проекта Cubix.</p>\n","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded while waiting for event \"download\"\n=========================== logs ===========================\nwaiting for event \"download\"\n============================================================","statusTrace":"cubix_page = <pages.projects.qube.cubix_page.CubixPage object at 0x1063ae0d0>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Скачивание PDF предложения\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    @pytest.mark.flaky(reruns=2, reruns_delay=2)\n    def test_cubix_download_pdf_on_agent_page(cubix_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                cubix_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                cubix_page.map.navigate_to_project(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n                cubix_page.navigation.find_and_click_available_apartment()\n    \n            with allure.step(\"Кликаем на кнопку Sales Offer\"):\n                cubix_page.click_sales_offer_button()\n    \n            with allure.step(\"Скачиваем PDF\"):\n>               success, file_path = cubix_page.download_pdf_and_verify()\n                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.projects.qube.cubix_page.CubixPage object at 0x1063ae0d0>\n\n    def download_pdf_and_verify(self):\n        \"\"\"Скачать и проверить PDF.\"\"\"\n        import os\n    \n        import allure\n    \n>       with self.page.expect_download() as download_info:\n\npages/projects/qube/qube_base_page.py:91: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._sync_base.EventContextManager object at 0x105f0cc90>\nexc_type = None, exc_val = None, exc_tb = None\n\n    def __exit__(\n        self,\n        exc_type: Optional[Type[BaseException]],\n        exc_val: Optional[BaseException],\n        exc_tb: Optional[TracebackType],\n    ) -> None:\n        if exc_val:\n            self._event._cancel()\n        else:\n>           self._event.value\n\n/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py:85: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._sync_base.EventInfo object at 0x105f0cb50>\n\n    @property\n    def value(self) -> T:\n        while not self._future.done():\n            self._sync_base._dispatcher_fiber.switch()\n        asyncio._set_running_loop(self._sync_base._loop)\n        exception = self._future.exception()\n        if exception:\n>           raise exception\nE           playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded while waiting for event \"download\"\nE           =========================== logs ===========================\nE           waiting for event \"download\"\nE           ============================================================\n\n/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py:59: TimeoutError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"pytestconfig","time":{"start":1763491994170,"stop":1763491994170,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1763491994170,"stop":1763491994170,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_session_faker","time":{"start":1763491994171,"stop":1763491994212,"duration":41},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1763491994171,"stop":1763491994171,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1763491994171,"stop":1763491994171,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_environment","time":{"start":1763491994212,"stop":1763491994212,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1763491994212,"stop":1763491994378,"duration":166},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1763491994378,"stop":1763491995158,"duration":780},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1763491994378,"stop":1763491994378,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1763491994378,"stop":1763491994378,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1763491994378,"stop":1763491994378,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1763491994378,"stop":1763491994378,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1763491995158,"stop":1763491995158,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1763491995158,"stop":1763491995159,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1763491995159,"stop":1763491995159,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1763491995159,"stop":1763491995159,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1763492169022,"stop":1763492169023,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1763492169023,"stop":1763492169023,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1763492169023,"stop":1763492169023,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1763492169023,"stop":1763492169027,"duration":4},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1763492169027,"stop":1763492169149,"duration":122},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"cubix_page","time":{"start":1763492169149,"stop":1763492169149,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_test_parameters","time":{"start":1763492169149,"stop":1763492169149,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Тест скачивания PDF на агентской странице проекта Cubix.","status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded while waiting for event \"download\"\n=========================== logs ===========================\nwaiting for event \"download\"\n============================================================","statusTrace":"cubix_page = <pages.projects.qube.cubix_page.CubixPage object at 0x1063ae0d0>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Скачивание PDF предложения\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    @pytest.mark.flaky(reruns=2, reruns_delay=2)\n    def test_cubix_download_pdf_on_agent_page(cubix_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                cubix_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                cubix_page.map.navigate_to_project(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n                cubix_page.navigation.find_and_click_available_apartment()\n    \n            with allure.step(\"Кликаем на кнопку Sales Offer\"):\n                cubix_page.click_sales_offer_button()\n    \n            with allure.step(\"Скачиваем PDF\"):\n>               success, file_path = cubix_page.download_pdf_and_verify()\n                                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:29: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.projects.qube.cubix_page.CubixPage object at 0x1063ae0d0>\n\n    def download_pdf_and_verify(self):\n        \"\"\"Скачать и проверить PDF.\"\"\"\n        import os\n    \n        import allure\n    \n>       with self.page.expect_download() as download_info:\n\npages/projects/qube/qube_base_page.py:91: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._sync_base.EventContextManager object at 0x105f0cc90>\nexc_type = None, exc_val = None, exc_tb = None\n\n    def __exit__(\n        self,\n        exc_type: Optional[Type[BaseException]],\n        exc_val: Optional[BaseException],\n        exc_tb: Optional[TracebackType],\n    ) -> None:\n        if exc_val:\n            self._event._cancel()\n        else:\n>           self._event.value\n\n/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py:85: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <playwright._impl._sync_base.EventInfo object at 0x105f0cb50>\n\n    @property\n    def value(self) -> T:\n        while not self._future.done():\n            self._sync_base._dispatcher_fiber.switch()\n        asyncio._set_running_loop(self._sync_base._loop)\n        exception = self._future.exception()\n        if exception:\n>           raise exception\nE           playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded while waiting for event \"download\"\nE           =========================== logs ===========================\nE           waiting for event \"download\"\nE           ============================================================\n\n/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py:59: TimeoutError","steps":[{"name":"Открываем агентскую страницу","time":{"start":1763492169149,"stop":1763492173170,"duration":4021},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на проект Cubix","time":{"start":1763492173171,"stop":1763492175814,"duration":2643},"status":"passed","steps":[{"name":"Навигация к проекту CUBIX","time":{"start":1763492173171,"stop":1763492175814,"duration":2643},"status":"passed","steps":[{"name":"Ожидаем загрузки карты","time":{"start":1763492173171,"stop":1763492175293,"duration":2122},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на проект CUBIX","time":{"start":1763492175293,"stop":1763492175431,"duration":138},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на Explore Project для CUBIX","time":{"start":1763492175431,"stop":1763492175814,"duration":383},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":4,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},{"name":"Ищем и кликаем на первый доступный апартамент","time":{"start":1763492175814,"stop":1763492179356,"duration":3542},"status":"passed","steps":[{"name":"Ищем доступный апартамент в каталоге","time":{"start":1763492175814,"stop":1763492179356,"duration":3542},"status":"passed","steps":[],"attachments":[{"uid":"90e1e77434972334","name":"Selected Apartment","source":"90e1e77434972334.attach","type":"text/plain","size":49}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":1,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"Кликаем на кнопку Sales Offer","time":{"start":1763492179356,"stop":1763492179574,"duration":218},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Скачиваем PDF","time":{"start":1763492179575,"stop":1763492209590,"duration":30015},"status":"broken","statusMessage":"playwright._impl._errors.TimeoutError: Timeout 30000ms exceeded while waiting for event \"download\"\n=========================== logs ===========================\nwaiting for event \"download\"\n============================================================\n","statusTrace":"  File \"/Users/runner/work/catalog_autotests/catalog_autotests/tests/ui/qube/cubix/test_cubix_agent_route.py\", line 29, in test_cubix_download_pdf_on_agent_page\n    success, file_path = cubix_page.download_pdf_and_verify()\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/runner/work/catalog_autotests/catalog_autotests/pages/projects/qube/qube_base_page.py\", line 91, in download_pdf_and_verify\n    with self.page.expect_download() as download_info:\n  File \"/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py\", line 85, in __exit__\n    self._event.value\n  File \"/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/playwright/_impl/_sync_base.py\", line 59, in value\n    raise exception\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":10,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_test_parameters::0","time":{"start":1763492209595,"stop":1763492209810,"duration":215},"status":"passed","steps":[],"attachments":[{"uid":"70a5ebfce2676c47","name":"screenshot","source":"70a5ebfce2676c47.png","type":"image/png","size":1327939}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"new_context::0","time":{"start":1763492209811,"stop":1763492209833,"duration":22},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1763492209833,"stop":1763492209833,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1763492700911,"stop":1763492700911,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1763492700912,"stop":1763492700926,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1763492700939,"stop":1763492700945,"duration":6},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"environment","value":"prod"},{"name":"feature","value":"Qube - Проект Cubix"},{"name":"story","value":"Скачивание PDF предложения"},{"name":"tag","value":"ui"},{"name":"tag","value":"regression"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.ui.qube.cubix"},{"name":"suite","value":"test_cubix_agent_route"},{"name":"host","value":"sat12-dp150-de01d14c-8a97-45f2-b1b7-51f28e39a063-3EA602B44BA0.local"},{"name":"thread","value":"11345-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.ui.qube.cubix.test_cubix_agent_route"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"Device","value":"'desktop'"},{"name":"Operating System","value":"'macOS'"},{"name":"Platform","value":"'macos-latest'"},{"name":"browser_name","value":"'webkit'"}],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":["ui","regression","smoke"]},"source":"7ff5ba71b85be469.json","parameterValues":["'desktop'","'macOS'","'macos-latest'","'webkit'"]}