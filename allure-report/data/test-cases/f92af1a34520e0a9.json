{"uid":"f92af1a34520e0a9","name":"test_cubix_download_pdf_on_agent_page[chromium]","fullName":"tests.ui.qube.cubix.test_cubix_agent_route#test_cubix_download_pdf_on_agent_page","historyId":"20eea60516844bfd7d86fbc94c8b8a60","time":{"start":1759254660810,"stop":1759254672415,"duration":11605},"description":"Тест скачивания PDF на агентской странице проекта Cubix.","descriptionHtml":"<p>Тест скачивания PDF на агентской странице проекта Cubix.</p>\n","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x00000265E15178D0>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests\\ui\\qube\\cubix\\test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.qube.agent_page.AgentPage object at 0x00000265E15178D0>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages\\qube\\agent_page.py:139: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1759254512889,"stop":1759254513318,"duration":429},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1759254513318,"stop":1759254513319,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1759254513319,"stop":1759254513804,"duration":485},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1759254513319,"stop":1759254513319,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_environment","time":{"start":1759254513319,"stop":1759254513319,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1759254513319,"stop":1759254513319,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1759254513319,"stop":1759254513319,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1759254513804,"stop":1759254513804,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1759254513804,"stop":1759254513804,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1759254513804,"stop":1759254513804,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1759254513804,"stop":1759254514004,"duration":200},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1759254513804,"stop":1759254513804,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1759254514004,"stop":1759254514021,"duration":17},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1759254514004,"stop":1759254514004,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759254514021,"stop":1759254514021,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759254514021,"stop":1759254514021,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1759254660691,"stop":1759254660691,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1759254660691,"stop":1759254660692,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1759254660692,"stop":1759254660706,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1759254660692,"stop":1759254660692,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1759254660708,"stop":1759254660808,"duration":100},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"agent_page","time":{"start":1759254660808,"stop":1759254660808,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_test_parameters","time":{"start":1759254660808,"stop":1759254660808,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Тест скачивания PDF на агентской странице проекта Cubix.","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x00000265E15178D0>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests\\ui\\qube\\cubix\\test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <pages.qube.agent_page.AgentPage object at 0x00000265E15178D0>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages\\qube\\agent_page.py:139: AssertionError","steps":[{"name":"Открываем агентскую страницу","time":{"start":1759254660810,"stop":1759254665587,"duration":4777},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на проект Cubix","time":{"start":1759254665587,"stop":1759254668523,"duration":2936},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Ищем и кликаем на первый доступный апартамент","time":{"start":1759254668523,"stop":1759254672415,"duration":3892},"status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n","statusTrace":"  File \"D:\\a\\catalog_autotests\\catalog_autotests\\tests\\ui\\qube\\cubix\\test_cubix_agent_route.py\", line 22, in test_cubix_download_pdf_on_agent_page\n    agent_page.find_and_click_available_apartment(\"cubix\")\n  File \"D:\\a\\catalog_autotests\\catalog_autotests\\pages\\qube\\agent_page.py\", line 139, in find_and_click_available_apartment\n    False\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_test_parameters::0","time":{"start":1759254672425,"stop":1759254672671,"duration":246},"status":"passed","steps":[],"attachments":[{"uid":"b0430e96b66aec61","name":"screenshot","source":"b0430e96b66aec61.png","type":"image/png","size":537586}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"new_context::0","time":{"start":1759254672673,"stop":1759254672688,"duration":15},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1759254672688,"stop":1759254672688,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1759254774237,"stop":1759254774237,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1759254774240,"stop":1759254774286,"duration":46},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1759254774290,"stop":1759254774302,"duration":12},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"environment","value":"prod"},{"name":"story","value":"Агентский роут - Загрузка PDF"},{"name":"feature","value":"Qube - Проект Cubix"},{"name":"tag","value":"ui"},{"name":"tag","value":"regression"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.ui.qube.cubix"},{"name":"suite","value":"test_cubix_agent_route"},{"name":"host","value":"runnervm747y6"},{"name":"thread","value":"6560-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.ui.qube.cubix.test_cubix_agent_route"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"Operating System","value":"'Windows'"},{"name":"Platform","value":"'windows-latest'"},{"name":"browser_name","value":"'chromium'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":42,"unknown":0,"total":43},"items":[{"uid":"e25c338ac794b4fd","status":"passed","time":{"start":1759219908276,"stop":1759219928762,"duration":20486}},{"uid":"b091ce5e64577f6","status":"passed","time":{"start":1759133536196,"stop":1759133558626,"duration":22430}},{"uid":"438f601387d679b6","status":"passed","time":{"start":1759047087744,"stop":1759047103966,"duration":16222}},{"uid":"9dfaf637e595e47b","status":"passed","time":{"start":1758960636117,"stop":1758960653680,"duration":17563}},{"uid":"726f4e97ac2493b8","status":"passed","time":{"start":1758874389061,"stop":1758874409295,"duration":20234}},{"uid":"6201c435f0fc2f3f","status":"passed","time":{"start":1758831547975,"stop":1758831568804,"duration":20829}},{"uid":"4579f853caf5fa","status":"passed","time":{"start":1758824004040,"stop":1758824024721,"duration":20681}},{"uid":"1876a4fa5077af3b","status":"passed","time":{"start":1758819278395,"stop":1758819299677,"duration":21282}},{"uid":"400958aa213809b1","status":"passed","time":{"start":1758817961264,"stop":1758817979811,"duration":18547}},{"uid":"df054e16a1112cc","status":"passed","time":{"start":1758787795161,"stop":1758787813625,"duration":18464}},{"uid":"1f5ec6deb3d62b36","status":"passed","time":{"start":1758742069160,"stop":1758742089400,"duration":20240}},{"uid":"275676f14c528e5b","status":"passed","time":{"start":1758740204245,"stop":1758740223376,"duration":19131}},{"uid":"f570e15334bf90e9","status":"passed","time":{"start":1758732403207,"stop":1758732422915,"duration":19708}},{"uid":"53b8a8863e5708e7","status":"passed","time":{"start":1758730781906,"stop":1758730801662,"duration":19756}},{"uid":"d2ee6183b95427d","status":"passed","time":{"start":1758715104775,"stop":1758715123384,"duration":18609}},{"uid":"4d3707b9e2245577","status":"passed","time":{"start":1758714769669,"stop":1758714785587,"duration":15918}},{"uid":"9415446e602df9b9","status":"passed","time":{"start":1758701437598,"stop":1758701455310,"duration":17712}},{"uid":"972824564e278b5c","status":"passed","time":{"start":1758657981415,"stop":1758657998170,"duration":16755}},{"uid":"319ccb73f4b8e18f","status":"passed","time":{"start":1758614989692,"stop":1758615009854,"duration":20162}},{"uid":"bd266e7adbe3cc7b","status":"passed","time":{"start":1758528629539,"stop":1758528648382,"duration":18843}}]},"tags":["ui","regression","smoke"]},"source":"f92af1a34520e0a9.json","parameterValues":["'Windows'","'windows-latest'","'chromium'"]}