{"uid":"ee0a2d4e6f2d9338","name":"test_cubix_download_pdf_on_agent_page[webkit]","fullName":"tests.ui.qube.cubix.test_cubix_agent_route#test_cubix_download_pdf_on_agent_page","historyId":"fb296acaa25e0aa60f7e7cf99bea9e7f","time":{"start":1759254375953,"stop":1759254387289,"duration":11336},"description":"Тест скачивания PDF на агентской странице проекта Cubix.","descriptionHtml":"<p>Тест скачивания PDF на агентской странице проекта Cubix.</p>\n","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x105a12e10>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.qube.agent_page.AgentPage object at 0x105a12e10>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages/qube/agent_page.py:139: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1759254234652,"stop":1759254234702,"duration":50},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1759254234652,"stop":1759254234652,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1759254234652,"stop":1759254234652,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1759254234652,"stop":1759254234652,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1759254234652,"stop":1759254234652,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1759254234702,"stop":1759254234950,"duration":248},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_environment","time":{"start":1759254234702,"stop":1759254234702,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1759254234950,"stop":1759254234950,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1759254234950,"stop":1759254235998,"duration":1048},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1759254234950,"stop":1759254234950,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1759254234950,"stop":1759254234950,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1759254234950,"stop":1759254234950,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1759254235998,"stop":1759254235998,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759254235999,"stop":1759254235999,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1759254235999,"stop":1759254235999,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759254235999,"stop":1759254235999,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1759254375674,"stop":1759254375675,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1759254375675,"stop":1759254375675,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1759254375675,"stop":1759254375675,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1759254375675,"stop":1759254375689,"duration":14},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1759254375689,"stop":1759254375952,"duration":263},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"agent_page","time":{"start":1759254375952,"stop":1759254375952,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_test_parameters","time":{"start":1759254375952,"stop":1759254375952,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Тест скачивания PDF на агентской странице проекта Cubix.","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x105a12e10>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.qube.agent_page.AgentPage object at 0x105a12e10>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages/qube/agent_page.py:139: AssertionError","steps":[{"name":"Открываем агентскую страницу","time":{"start":1759254375953,"stop":1759254380384,"duration":4431},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на проект Cubix","time":{"start":1759254380384,"stop":1759254383417,"duration":3033},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Ищем и кликаем на первый доступный апартамент","time":{"start":1759254383417,"stop":1759254387287,"duration":3870},"status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n","statusTrace":"  File \"/Users/runner/work/catalog_autotests/catalog_autotests/tests/ui/qube/cubix/test_cubix_agent_route.py\", line 22, in test_cubix_download_pdf_on_agent_page\n    agent_page.find_and_click_available_apartment(\"cubix\")\n  File \"/Users/runner/work/catalog_autotests/catalog_autotests/pages/qube/agent_page.py\", line 139, in find_and_click_available_apartment\n    False\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_test_parameters::0","time":{"start":1759254387333,"stop":1759254387541,"duration":208},"status":"passed","steps":[],"attachments":[{"uid":"9ed4f1af0c3fd8b6","name":"screenshot","source":"9ed4f1af0c3fd8b6.png","type":"image/png","size":852397}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"new_context::0","time":{"start":1759254387542,"stop":1759254387596,"duration":54},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1759254387598,"stop":1759254387598,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1759254501163,"stop":1759254501164,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1759254501164,"stop":1759254501194,"duration":30},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1759254501201,"stop":1759254501220,"duration":19},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"environment","value":"prod"},{"name":"story","value":"Агентский роут - Загрузка PDF"},{"name":"feature","value":"Qube - Проект Cubix"},{"name":"tag","value":"ui"},{"name":"tag","value":"regression"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.ui.qube.cubix"},{"name":"suite","value":"test_cubix_agent_route"},{"name":"host","value":"sat12-bq163-be2c11a0-520a-4a2a-bf5d-d04ccc3dee52-7AFCBF9788AD.local"},{"name":"thread","value":"11327-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.ui.qube.cubix.test_cubix_agent_route"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"Operating System","value":"'macOS'"},{"name":"Platform","value":"'macos-latest'"},{"name":"browser_name","value":"'webkit'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":2,"broken":0,"skipped":0,"passed":41,"unknown":0,"total":43},"items":[{"uid":"d3ba415152613ebd","status":"passed","time":{"start":1759219696313,"stop":1759219714343,"duration":18030}},{"uid":"691ac995cff34aaa","status":"passed","time":{"start":1759133283402,"stop":1759133301247,"duration":17845}},{"uid":"27431ff1833d35f","status":"passed","time":{"start":1759046843280,"stop":1759046861452,"duration":18172}},{"uid":"12ffc0444ab3bedc","status":"passed","time":{"start":1758960449640,"stop":1758960473455,"duration":23815}},{"uid":"66b324ebd2b4f05","status":"passed","time":{"start":1758874076188,"stop":1758874094492,"duration":18304}},{"uid":"ddac2b1ad8b04667","status":"passed","time":{"start":1758831286127,"stop":1758831303825,"duration":17698}},{"uid":"d3c3c6962d1af1e3","status":"passed","time":{"start":1758823658398,"stop":1758823676576,"duration":18178}},{"uid":"941196665bca6784","status":"passed","time":{"start":1758818859277,"stop":1758818879901,"duration":20624}},{"uid":"416adf1d51644430","status":"passed","time":{"start":1758817775675,"stop":1758817796957,"duration":21282}},{"uid":"f2a8c888ca2a0734","status":"failed","statusDetails":"AssertionError: PDF не был скачан\nassert False","time":{"start":1758787588602,"stop":1758787607342,"duration":18740}},{"uid":"2c31b6dd9bfc12af","status":"passed","time":{"start":1758741828553,"stop":1758741848154,"duration":19601}},{"uid":"ef6e1dfb5dd71887","status":"passed","time":{"start":1758739903487,"stop":1758739922579,"duration":19092}},{"uid":"524a567df04108ae","status":"passed","time":{"start":1758732168960,"stop":1758732190282,"duration":21322}},{"uid":"dcb64f12c961fc41","status":"passed","time":{"start":1758730505405,"stop":1758730523395,"duration":17990}},{"uid":"ad06c0643b42ac1f","status":"passed","time":{"start":1758714857602,"stop":1758714875796,"duration":18194}},{"uid":"1e286a67f03be12a","status":"passed","time":{"start":1758714574147,"stop":1758714600316,"duration":26169}},{"uid":"af8edae30f5dc1d2","status":"passed","time":{"start":1758701190117,"stop":1758701208495,"duration":18378}},{"uid":"e9fbaf8dd681945","status":"passed","time":{"start":1758657809243,"stop":1758657829095,"duration":19852}},{"uid":"2c20f9196b70588","status":"passed","time":{"start":1758614783881,"stop":1758614805044,"duration":21163}},{"uid":"963812ea9220d072","status":"passed","time":{"start":1758528421074,"stop":1758528439808,"duration":18734}}]},"tags":["ui","regression","smoke"]},"source":"ee0a2d4e6f2d9338.json","parameterValues":["'macOS'","'macos-latest'","'webkit'"]}