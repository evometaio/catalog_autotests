{"uid":"f148fef9b23d4f36","name":"test_cubix_download_pdf_on_agent_page[firefox]","fullName":"tests.ui.qube.cubix.test_cubix_agent_route#test_cubix_download_pdf_on_agent_page","historyId":"25eac15c87a148601e8bb836d0933824","time":{"start":1759307087817,"stop":1759307098094,"duration":10277},"description":"Тест скачивания PDF на агентской странице проекта Cubix.","descriptionHtml":"<p>Тест скачивания PDF на агентской странице проекта Cubix.</p>\n","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x7f7e5e5a0a10>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.qube.agent_page.AgentPage object at 0x7f7e5e5a0a10>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages/qube/agent_page.py:139: AssertionError","flaky":false,"newFailed":true,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[{"name":"_session_faker","time":{"start":1759306970711,"stop":1759306970788,"duration":77},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"base_url","time":{"start":1759306970711,"stop":1759306970711,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_verify_url","time":{"start":1759306970711,"stop":1759306970711,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"pytestconfig","time":{"start":1759306970788,"stop":1759306970788,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright","time":{"start":1759306970789,"stop":1759306971087,"duration":298},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"delete_output_dir","time":{"start":1759306970789,"stop":1759306970789,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_environment","time":{"start":1759306970789,"stop":1759306970789,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type","time":{"start":1759306971087,"stop":1759306971087,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser","time":{"start":1759306971087,"stop":1759306971606,"duration":519},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_type_launch_args","time":{"start":1759306971087,"stop":1759306971087,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"launch_browser","time":{"start":1759306971087,"stop":1759306971087,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"connect_options","time":{"start":1759306971087,"stop":1759306971087,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"device","time":{"start":1759306971606,"stop":1759306971606,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder","time":{"start":1759306971606,"stop":1759306971606,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759306971607,"stop":1759306971607,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser_context_args","time":{"start":1759306971607,"stop":1759306971607,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"context","time":{"start":1759307087610,"stop":1759307087630,"duration":20},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"output_path","time":{"start":1759307087610,"stop":1759307087610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"new_context","time":{"start":1759307087610,"stop":1759307087610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder","time":{"start":1759307087610,"stop":1759307087610,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"page","time":{"start":1759307087630,"stop":1759307087816,"duration":186},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"setup_test_parameters","time":{"start":1759307087816,"stop":1759307087816,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"agent_page","time":{"start":1759307087816,"stop":1759307087816,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"testStage":{"description":"Тест скачивания PDF на агентской странице проекта Cubix.","status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix","statusTrace":"agent_page = <pages.qube.agent_page.AgentPage object at 0x7f7e5e5a0a10>\n\n    @allure.feature(\"Qube - Проект Cubix\")\n    @allure.story(\"Агентский роут - Загрузка PDF\")\n    @pytest.mark.smoke\n    @pytest.mark.regression\n    @pytest.mark.ui\n    def test_cubix_download_pdf_on_agent_page(agent_page):\n        \"\"\"Тест скачивания PDF на агентской странице проекта Cubix.\"\"\"\n        downloaded_file_path = \"\"\n    \n        try:\n            with allure.step(\"Открываем агентскую страницу\"):\n                agent_page.open(route_type=\"agent\")\n    \n            with allure.step(\"Кликаем на проект Cubix\"):\n                agent_page.click_project_on_map(\"cubix\")\n    \n            with allure.step(\"Ищем и кликаем на первый доступный апартамент\"):\n>               agent_page.find_and_click_available_apartment(\"cubix\")\n\ntests/ui/qube/cubix/test_cubix_agent_route.py:22: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \n\nself = <pages.qube.agent_page.AgentPage object at 0x7f7e5e5a0a10>\nproject_name = 'cubix'\n\n    def find_and_click_available_apartment(self, project_name: str = None):\n        \"\"\"\n        Найти и кликнуть на первый доступный апартамент (без замка).\n        Универсальный метод для всех проектов.\n    \n        Args:\n            project_name: Название проекта (используется только для логирования)\n    \n        Returns:\n            str: Название выбранного апартамента\n        \"\"\"\n        # Ждем загрузки апартаментов\n        self.page.wait_for_selector(\n            self.project_locators.ALL_APARTMENT_TITLES, state=\"attached\", timeout=10000\n        )\n    \n        # Используем локатор из project_locators.py\n        apartment_titles = self.page.locator(self.project_locators.ALL_APARTMENT_TITLES)\n        apartment_count = apartment_titles.count()\n    \n        # Проверяем, что апартаменты найдены на странице\n        assert (\n            apartment_count > 0\n        ), f\"Апартаменты не найдены на странице - баг в UI для проекта {project_name or 'неизвестный'}\"\n    \n        # Ищем первый доступный апартамент (без замка)\n        for i in range(apartment_count):\n            apartment_title = apartment_titles.nth(i)\n            apartment_text = apartment_title.text_content()\n    \n            # Проверяем, есть ли замок у этого апартамента\n            lock_icon = apartment_title.locator(\n                \"xpath=.//span[@role='img' and @aria-label='lock']\"\n            )\n            has_lock = lock_icon.count() > 0\n    \n            # Если замка нет, ждем готовности элемента и кликаем\n            if not has_lock:\n                # Ждем, что элемент станет видимым и активным\n                try:\n                    apartment_title.wait_for(state=\"visible\", timeout=2000)\n                except:\n                    continue  # Если не стал видимым, пробуем следующий апартамент\n    \n                # Проверяем готовность к клику\n                if apartment_title.is_visible() and apartment_title.is_enabled():\n                    apartment_title.click()\n                    return apartment_text\n    \n        # Если все апартаменты заблокированы\n        assert (\n>           False\n        ), f\"Все апартаменты заблокированы (имеют замок) - баг в UI для проекта {project_name or 'неизвестный'}\"\nE       AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n\npages/qube/agent_page.py:139: AssertionError","steps":[{"name":"Открываем агентскую страницу","time":{"start":1759307087817,"stop":1759307091229,"duration":3412},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Кликаем на проект Cubix","time":{"start":1759307091229,"stop":1759307094256,"duration":3027},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"Ищем и кликаем на первый доступный апартамент","time":{"start":1759307094256,"stop":1759307098094,"duration":3838},"status":"failed","statusMessage":"AssertionError: Все апартаменты заблокированы (имеют замок) - баг в UI для проекта cubix\n","statusTrace":"  File \"/home/runner/work/catalog_autotests/catalog_autotests/tests/ui/qube/cubix/test_cubix_agent_route.py\", line 22, in test_cubix_download_pdf_on_agent_page\n    agent_page.find_and_click_available_apartment(\"cubix\")\n  File \"/home/runner/work/catalog_autotests/catalog_autotests/pages/qube/agent_page.py\", line 139, in find_and_click_available_apartment\n    False\n","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":0,"hasContent":true,"attachmentStep":false}],"attachments":[],"parameters":[],"shouldDisplayMessage":true,"stepsCount":3,"attachmentsCount":0,"hasContent":true,"attachmentStep":false},"afterStages":[{"name":"setup_test_parameters::0","time":{"start":1759307098129,"stop":1759307098219,"duration":90},"status":"passed","steps":[],"attachments":[{"uid":"8ea8e1f35856bda3","name":"screenshot","source":"8ea8e1f35856bda3.png","type":"image/png","size":612644}],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":1,"hasContent":true,"attachmentStep":false},{"name":"new_context::0","time":{"start":1759307098220,"stop":1759307098230,"duration":10},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_artifacts_recorder::0","time":{"start":1759307098231,"stop":1759307098231,"duration":0},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"_pw_artifacts_folder::0","time":{"start":1759307187232,"stop":1759307187233,"duration":1},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"browser::0","time":{"start":1759307187234,"stop":1759307187463,"duration":229},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false},{"name":"playwright::0","time":{"start":1759307187465,"stop":1759307187473,"duration":8},"status":"passed","steps":[],"attachments":[],"parameters":[],"shouldDisplayMessage":false,"stepsCount":0,"attachmentsCount":0,"hasContent":false,"attachmentStep":false}],"labels":[{"name":"environment","value":"prod"},{"name":"story","value":"Агентский роут - Загрузка PDF"},{"name":"feature","value":"Qube - Проект Cubix"},{"name":"tag","value":"ui"},{"name":"tag","value":"regression"},{"name":"tag","value":"smoke"},{"name":"parentSuite","value":"tests.ui.qube.cubix"},{"name":"suite","value":"test_cubix_agent_route"},{"name":"host","value":"runnervm3ublj"},{"name":"thread","value":"5162-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.ui.qube.cubix.test_cubix_agent_route"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"Operating System","value":"'Linux'"},{"name":"Platform","value":"'ubuntu-latest'"},{"name":"browser_name","value":"'firefox'"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"history":{"statistic":{"failed":1,"broken":0,"skipped":0,"passed":43,"unknown":0,"total":44},"items":[{"uid":"e7cd91cccb6e8e02","status":"passed","time":{"start":1759254457871,"stop":1759254477829,"duration":19958}},{"uid":"67a98ffbca8f0918","status":"passed","time":{"start":1759220201478,"stop":1759220219681,"duration":18203}},{"uid":"b67024dd2011ec1d","status":"passed","time":{"start":1759133431109,"stop":1759133450248,"duration":19139}},{"uid":"e215dd29b9056c8","status":"passed","time":{"start":1759046864470,"stop":1759046885009,"duration":20539}},{"uid":"8d05f083f9f32ba5","status":"passed","time":{"start":1758960482060,"stop":1758960501589,"duration":19529}},{"uid":"6013e0fcea2541d5","status":"passed","time":{"start":1758874190342,"stop":1758874212232,"duration":21890}},{"uid":"b8f9906a9edd9e66","status":"passed","time":{"start":1758831456769,"stop":1758831475186,"duration":18417}},{"uid":"da538685d0f6e12b","status":"passed","time":{"start":1758823756336,"stop":1758823774638,"duration":18302}},{"uid":"ba77292e6b4ab0ad","status":"passed","time":{"start":1758818884764,"stop":1758818903665,"duration":18901}},{"uid":"c1e98748d3509844","status":"passed","time":{"start":1758817824856,"stop":1758817843045,"duration":18189}},{"uid":"7b3b962f1e70ec8e","status":"passed","time":{"start":1758787666400,"stop":1758787683318,"duration":16918}},{"uid":"135c74d48288ec6d","status":"passed","time":{"start":1758741868653,"stop":1758741889094,"duration":20441}},{"uid":"2d6a43ac843e7f00","status":"passed","time":{"start":1758739987124,"stop":1758740003329,"duration":16205}},{"uid":"8d81d2b6f8763ff3","status":"passed","time":{"start":1758732229126,"stop":1758732246014,"duration":16888}},{"uid":"970b3890beab03bf","status":"passed","time":{"start":1758730659631,"stop":1758730676532,"duration":16901}},{"uid":"2cc3eb2df856b534","status":"passed","time":{"start":1758714999770,"stop":1758715017031,"duration":17261}},{"uid":"71648a746910f586","status":"passed","time":{"start":1758714641565,"stop":1758714658540,"duration":16975}},{"uid":"922ae1be2b9518c1","status":"passed","time":{"start":1758701220219,"stop":1758701237406,"duration":17187}},{"uid":"e14030c6ed8cd4","status":"passed","time":{"start":1758657849068,"stop":1758657867770,"duration":18702}},{"uid":"f22e39a06a931f19","status":"passed","time":{"start":1758614841616,"stop":1758614858322,"duration":16706}}]},"tags":["ui","regression","smoke"]},"source":"f148fef9b23d4f36.json","parameterValues":["'Linux'","'ubuntu-latest'","'firefox'"]}